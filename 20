System.Data.OleDb.OleDbException: 'SQL0104: Símbolo BPPGM no válido. Símbolos válidos: ( INTO USING.
Causa . . . . . :   Se ha detectado un error de sintaxis en el símbolo BPPGM. El símbolo BPPGM no es un símbolo válido. Una lista parcial de símbolos válidos es ( INTO USING. Esta lista presupone que la sentencia es correcta hasta el símbolo. El error puede estar anteriormente en la sentencia, pero la sintaxis de la sentencia aparece como válida hasta este punto. Recuperación . . . :   Efectúe una o más de las siguientes acciones y vuelva a intentar la petición: -- Verifique la sentencia SQL en el área del símbolo BPPGM. Corrija la sentencia. El error podría ser la omisión de una coma o comillas; podría tratarse de una palabra con errores ortográficos, o podría estar relacionado con el orden de las cláusulas. -- Si el símbolo de error es <FIN DE SENTENCIA>, corrija la sentencia SQL porque no finaliza con una cláusula válida.'



Esta excepción se generó originalmente en esta pila de llamadas:
    [Código externo]
    reposicion_pin.Repository.AS400Repository.EjecutarProgramaAsync(reposicion_pin.DTOs.AS400RequestDto) en AS400Repository.cs



Yo realmente no se como funciona este programa... Pero este es un ejemplo que el equipo de AS400 me envió -... con lo que ellos hacen pruebas:

CALL PGM(REIMQ07RC) PARM(('100000000170384120191130'))
 

Quiero que te guies mucho por como se hace en los ejemplos compartidos de TD



using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Data.OleDb;
using System.Data;
using System.Configuration;

namespace SistemaCobranzasBP.Clases
{
    public class ClassAS400
    {
        private string _ConnectionString;
        private string _Query;
        private string _Mensaje;
        private bool _Success;
        private int _CommandTimeout;
        private List<OleDbParameter> _Parametros = new List<OleDbParameter>();
        private DataTable _dtLibrerias = new DataTable();
        private string _Comando;
       // private List<> _Librerias = new List<OleDbParameter>();

        //Contructores de la clase
        #region Constructores
        public ClassAS400(string conexion,string query)
        {
            this._ConnectionString = conexion;
            this._Query = query;
            this._Mensaje = string.Empty;
            this._Success = true;
            this._CommandTimeout = 300;
            this._dtLibrerias = null;
            this._Comando = string.Empty;
        }


        public ClassAS400(string conexion, string query, DataTable librerias)
        {
            this._ConnectionString = conexion;
            this._Query = query;
            this._Mensaje = string.Empty;
            this._Success = true;
            this._CommandTimeout = 300;
            this._dtLibrerias = librerias;
            this.LimpiarParametros = true;
        } 
        #endregion

        //Propiendas de los campos
        #region Propiedades
        public string ConnectionString
        {
            set { this._ConnectionString = value; }
            get { return this._ConnectionString; }
        }

        public string Query
        {
            set { this._Query = value; }
            get { return this._Query; }
        }

        public string Mensaje
        {
            get { return this._Mensaje; }
        }

        public bool LimpiarParametros { get; set; }

        public List<OleDbParameter> Parametros
        {
            get { return this._Parametros; }
        }

        public bool Success
        {
            get { return this._Success; }
        }

        public int CommandTimeout
        {
            set { this._CommandTimeout = value; }
            get { return this._CommandTimeout; }
        }

        public string Comando
        {
            get { return this._Comando; }
        }
        public DataTable dtLibrerias
        {
            get { return this._dtLibrerias; }
        }
        #endregion

        //Ejecuta los Calls tipo Procedure con sus parametros correspondientes y regresa DataTable
        public DataTable dtProcedureCALL()
        {
            this._Mensaje = string.Empty;
            this._Success = true;
            DataTable dt = new DataTable();
            
            try
            {
                using (OleDbConnection Conn = new OleDbConnection(this._ConnectionString))                
                {
                    //Abre las conexiones si estan cerradas
                    if (Conn.State == ConnectionState.Closed)                    
                        Conn.Open();

                    OleDbCommand com = new OleDbCommand();
                    com.Connection = Conn;
                    com.CommandText = this._Query;
                    com.CommandType = CommandType.StoredProcedure;
                    com.CommandTimeout = this._CommandTimeout;


                    //Recorre los parametros para enviarlos a el Call
                    if (this._Parametros.Count > 0)
                    {
                        foreach (OleDbParameter param in this._Parametros)
                        {                           
                           
                            com.Parameters.Add(param);
                            //logParametros += " Parámetro " + param.ParameterName + " : " + param.Value + ", ";
                        }


                        using (OleDbDataReader reader = com.ExecuteReader())
                        {
                            dt.Load(reader);

                            if (!reader.IsClosed)
                                reader.Close();
                        }

                    }

                    

                    //Cierras las conexiones si estan abiertas
                    if (Conn.State == ConnectionState.Open)
                    {
                        Conn.Close();
                        Conn.Dispose();
                    }

                }

                            }
            catch (Exception ex)
            {
                //log.Error(ex.ToString() + logParametros);
                this._Mensaje = ex.Message.ToString();
                this._Success = false;
            }

            this._Parametros.Clear();
            return dt;
            
        }

        //Ejecuta los Calls con sus parametros correspondientes
        public void exeParamPRGCALL()
        {
            this._Mensaje = string.Empty;
            this._Success = true;
           // DataTable dt = new DataTable();

            try
            {
                using (OleDbConnection Conn = new OleDbConnection(this._ConnectionString))
                {
                    //Abre las conexiones si estan cerradas
                    if (Conn.State == ConnectionState.Closed)
                        Conn.Open();

                    //Creea el comando para ejecutar el programa
                    OleDbCommand com = new OleDbCommand(this._Query, Conn);
                    com.CommandType = CommandType.Text;   

                    //Recorre los parametros para enviarlos a el Call
                    if (this._Parametros.Count > 0)
                    {
                        foreach (OleDbParameter param in this._Parametros)
                        {

                            com.Parameters.Add(param);
                        }

                        //agrega las librerias para la ejecución del programa
                        if (this._dtLibrerias.Rows.Count > 0)
                        {
                            OleDbCommand comLib = new OleDbCommand();
                            comLib.CommandType = CommandType.Text;
                            comLib.Connection = Conn;

                            //Limpia la librerias ya cargadas anteriormente
                            comLib.CommandText = "{{CALL PGM(QSYS/QCMDEXC) PARM('CHGLIBL LIBL(*NONE)' 30)}}";
                            comLib.ExecuteNonQuery();

                            //Agrega las librerias parametrizadas en la tabla de la BD
                            foreach (DataRow row in _dtLibrerias.Rows) 
                            {                                
                                comLib.CommandText = "{{CALL PGM(QSYS/QCMDEXC) PARM('ADDLIBLE LIB("+row[0].ToString()+")' 30)}}";
                                comLib.ExecuteNonQuery();
                            }
                    
                        }

                        //Ejecuta el programa
                        com.ExecuteNonQuery();

                    }

                    //Cierras las conexiones si estan abiertas
                    if (Conn.State == ConnectionState.Open)
                    {
                        Conn.Close();
                        Conn.Dispose();
                    }

                }
            }
            catch (Exception ex)
            {
                //log.Error(ex.ToString() + logParametros);
                this._Mensaje = ex.Message.ToString();
                this._Success = false;
            }

            if (this.LimpiarParametros)
            {
                this._Parametros.Clear();
            }
            //return dt;

        }

        //Ejecuta los Calls con sus parametros correspondientes y devuelve DataTable
        public DataTable dtParamPRGCALL()
        {
            this._Mensaje = string.Empty;
            this._Success = true;
            DataTable dt = new DataTable();

            try
            {
                using (OleDbConnection Conn = new OleDbConnection(this._ConnectionString))
                {
                    //Abre las conexiones si estan cerradas
                    if (Conn.State == ConnectionState.Closed)
                        Conn.Open();

                    //Creea el comando para ejecutar el programa
                    OleDbCommand com = new OleDbCommand(this._Query, Conn);
                    com.CommandType = CommandType.Text;

                    //Recorre los parametros para enviarlos a el Call
                    if (this._Parametros.Count > 0)
                    {
                        foreach (OleDbParameter param in this._Parametros)
                        {

                            com.Parameters.Add(param);
                        }

                        //agrega las librerias para la ejecución del programa
                        if (this._dtLibrerias.Rows.Count > 0)
                        {
                            OleDbCommand comLib = new OleDbCommand();
                            comLib.CommandType = CommandType.Text;
                            comLib.Connection = Conn;

                            //Limpia la librerias ya cargadas anteriormente
                            comLib.CommandText = "{{CALL PGM(QSYS/QCMDEXC) PARM('CHGLIBL LIBL(*NONE)' 30)}}";
                            comLib.ExecuteNonQuery();

                            //Agrega las librerias parametrizadas en la tabla de la BD
                            foreach (DataRow row in _dtLibrerias.Rows)
                            {
                                comLib.CommandText = "{{CALL PGM(QSYS/QCMDEXC) PARM('ADDLIBLE LIB(" + row[0].ToString() + ")' 30)}}";
                                comLib.ExecuteNonQuery();
                            }

                        }

                        this._Comando = com.CommandText;
                        //Ejecuta el programa
                        com.ExecuteNonQuery();


                        //Crea el dt de respuesta
                        foreach (OleDbParameter param in this._Parametros)
                        {
                            dt.Columns.Add(param.ToString(), typeof(string));
                        }

                        //Llena dt de Respuesta
                        DataRow newRow = dt.NewRow();
                        foreach (OleDbParameter param in this._Parametros)
                        {
                            newRow[param.ToString()] = com.Parameters[param.ToString()].Value;

                        }

                        dt.Rows.Add(newRow);

                    }

                    //Cierras las conexiones si estan abiertas
                    if (Conn.State == ConnectionState.Open)
                    {
                        Conn.Close();
                        Conn.Dispose();
                    }

                }

            }
            catch (Exception ex)
            {
                //log.Error(ex.ToString() + logParametros);
                this._Mensaje = ex.Message.ToString();
                this._Success = false;
            }

            this._Parametros.Clear();
            return dt;

        }

    }
}



Y creo que aqui es donde lo llama :


                //Genera el mensaje de repuesta y el pin desde el as400
                log.Debug("Llamando a programa AS400");
                DataSet dsResult = new DataSet();
                dsResult = reponerPINAS400(CIF, Cuenta, UltimosDigitosTD);
                MensajeOC = MensajeRespuestaOC(dsResult.Tables[0].Rows[0][0].ToString(), dsResult.Tables[0].Rows[0][1].ToString());
                if (MensajeOC.Codigo == "200")
                {
                    Result = InsertarEvento(CIF, DNI, Cliente, MetodoEnvio, Telefono, OperadorTelefono, Correo, Cuenta, UltimosDigitosTD, ContenidoSMS, ContenidoCorreo, "Remision de pin de autoriza al WS");
                    if (Result != "true") { MensajeOC = MensajeRespuestaOC("P99", Result); log.Error(Result); return MensajeOC; }
                }
                else                
                    return MensajeOC;
               
                
