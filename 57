using reposicion_pin.DTOs;
using reposicion_pin.Models;
using reposicion_pin.Repository.Interface;
using reposicion_pin.Service.Interface;

namespace reposicion_pin.Service
{
    public class ReposicionPinNotificacionService : IReposicionPinNotificacionService
    {
        private readonly IEnvioSmsRepository _sms;
        private readonly IEnvioEmailRepository _email;
        private readonly IBandejaEnvioSmsRepository _bandejaSms;
        private readonly IBandejaEnvioEmailRepository _bandejaEmail;
        private readonly IConfiguration _configuration;
        private readonly ILogger<ReposicionPinNotificacionService> _logger;

        public ReposicionPinNotificacionService(
            IEnvioSmsRepository sms,
            IEnvioEmailRepository email,
            IBandejaEnvioSmsRepository bandejaSms,
            IBandejaEnvioEmailRepository bandejaEmail,
            IConfiguration configuration,
            ILogger<ReposicionPinNotificacionService> logger)
        {
            _sms = sms;
            _email = email;
            _bandejaSms = bandejaSms;
            _bandejaEmail = bandejaEmail;
            _configuration = configuration;
            _logger = logger;
        }

        public async Task<(int Codigo, string Mensaje)> EnviarAsync(
            TarjetaModel tarjeta,
            ReposicionPinRequestDto request,
            string pin)
        {
            string referencia = DateTimeOffset.UtcNow.ToUnixTimeMilliseconds().ToString();
            string tipoTarjeta = _configuration["ParametrosSMS:TipoTarjeta"] ?? "TDC";

            try
            {
                if (request.MetodoEnvio == 1)
                {
                    // Enviar SMS
                    var resultadoSms = await _sms.EnviarSmsDirectoAsync(
                        request.Telefono,
                        request.OperadorTelefono,
                        request.ContenidoSMS.Replace("@PIN", pin),
                        pin,
                        referencia,
                        CancellationToken.None
                    );

                    // Guardar en bandeja
                    var entidadSms = new BandejaEnvioSmsModel
                    {
                        NumeroTarjeta = tarjeta.NumeroTarjeta,
                        Celular = request.Telefono,
                        Telco = request.OperadorTelefono,
                        Sms = request.ContenidoSMS,
                        Referencia = referencia,
                        FechaInicio = DateTime.Now,
                        FechaFinal = DateTime.Now,
                        Estado = resultadoSms.Codigo != 0 ? 7 : 0,
                        DescripcionEstado = resultadoSms.Mensaje
                    };

                    await _bandejaSms.AddAsync(entidadSms);

                    return (resultadoSms.Codigo != 0 ? 7 : 0, resultadoSms.Mensaje);
                }
                else if (request.MetodoEnvio == 2)
                {
                    // Enviar correo
                    var resultadoEmail = await _email.EnviarCorreoAsync(
                        request.Correo,
                        request.ContenidoCorreo.Replace("@PIN", pin),
                        pin,
                        referencia,
                        CancellationToken.None
                    );

                    // Guardar en bandeja
                    var entidadEmail = new BandejaEnvioEmailModel
                    {
                        NumeroTarjeta = tarjeta.NumeroTarjeta,
                        CuerpoCorreo = request.ContenidoCorreo,
                        MailFrom = resultadoEmail.MailFrom,
                        MailSubject = resultadoEmail.MailSubject,
                        Correo = request.Correo,
                        Referencia = referencia,
                        FechaInicio = DateTime.Now,
                        FechaFinal = DateTime.Now,
                        Estado = resultadoEmail.Codigo != 0 ? 8 : 0,
                        DescripcionEstado = resultadoEmail.Mensaje
                    };

                    await _bandejaEmail.AddAsync(entidadEmail);

                    return (resultadoEmail.Codigo != 0 ? 8 : 0, resultadoEmail.Mensaje);
                }

                return (10, "Método de envío no soportado");
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error enviando notificación Ref:{Referencia}", referencia);
                return (99, $"Error al enviar notificación: {ex.Message}");
            }
        }
    }
}






Podemos manejarlo mas espcifico ? 




 if (resultado.Codigo != 0)
                    {
                        return await ObtenerRespuestaDinamicaAsync(
                            8,
                            "Codigo de Respuesta:",
                            $"{resultado.Codigo} - {resultado.Mensaje}"
                        );
                    }



Mira como lo hace ? es que no, hay demasiado relajo con eso
