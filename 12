USE [ReposicionPinTC]
GO

/****** Object:  Table [dbo].[Tarjetas]    Script Date: 5/2/2026 14:20:22 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [dbo].[Tarjetas](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[EquivalenteTC] [varchar](4) NULL,
	[CIF] [varchar](15) NULL,
	[EstadoTarjeta] [smallint] NULL,
	[FechaFinVigencia] [date] NULL,
	[EstadoHabilitar] [varchar](1) NULL,
 CONSTRAINT [PK_ETarjetas] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO



'int' no contiene una definición para 'EndsWith' y la mejor sobrecarga del método de extensión 'MemoryExtensions.EndsWith<string>(ReadOnlySpan<string>, string)' requiere un receptor del tipo 'System.ReadOnlySpan<string>'





Tengo el sigueinte error:

System.InvalidOperationException: 'The entity type 'TarjetaModel' requires a primary key to be defined. If you intended to use a keyless entity type, call 'HasNoKey' in 'OnModelCreating'. For more information on keyless entity types, see https://go.microsoft.com/fwlink/?linkid=2141943.'



Y se queda en esta linea de codigo:

     public async Task<TarjetaModel?> ObtenerTarjetaAsync(string cif, string ultimosDigitos)
     {
         return await _context.Tarjetas
             .Where(t => t.CIF == cif && t.EquivalenteTC.EndsWith(ultimosDigitos))
             .FirstOrDefaultAsync();
     }
 }




 Yo envié este request:
 {
  "cif": "1833417",
  "dni": "0506200201776",
  "cliente": "1833417",
  "metodoEnvio": 1,
  "telefono": "96423295",
  "operadorTelefono": "E",
  "correo": "",
  "ultimosDigitosTC": "4006",
  "contenidoSMS": "Holaaa",
  "contenidoCorreo": ""
}



En mi BD está esto unicamente:

EquivalenteTC	CIF	FechaFinVigencia	EstadoTarjeta	EstadoHabilitar
4006	1833417	2027-05-31	20	
7002	249898	2027-04-30	25	
2000	1933823	2027-05-31	20	
