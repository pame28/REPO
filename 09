using reposicion_pin.DTOs;
using reposicion_pin.Repository.Interface;
using reposicion_pin.Service.Interface;

namespace reposicion_pin.Service
{
    public class TarjetaService : ITarjetaService
    {
        private readonly IAS400Repository _as400Repository;

        public TarjetaService(IAS400Repository as400Repository)
        {
            _as400Repository = as400Repository;
        }

        // Devuelve el resultado genérico para toda la app
        public async Task<ResultadoValidacionDto> ValidarTarjetaAsync(string trama)
        {
            var resultadoAS400 = await _as400Repository.ValidarTarjetaAsync(trama);

            // Mapeamos al DTO genérico
            var resultado = new ResultadoValidacionDto
            {
                EsValido = resultadoAS400.CodigoError == "0",
                Codigo = resultadoAS400.CodigoError,
                Descripcion = resultadoAS400.DescripcionError
            };

            return resultado;
        }
    }
}
