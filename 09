namespace reposicion_pin.DTOs
{
    public class ResultadoValidacionDto
    {
        public bool EsValido { get; set; }
        public string Codigo { get; set; } = string.Empty;
        public string Descripcion { get; set; } = string.Empty;

        public static ResultadoValidacionDto Ok()
        {
            return new ResultadoValidacionDto
            {
                EsValido = true,
                Codigo = "0",
                Descripcion = "Validación correcta"
            };
        }

        public static ResultadoValidacionDto Error(string codigo, string descripcion)
        {
            return new ResultadoValidacionDto
            {
                EsValido = false,
                Codigo = codigo,
                Descripcion = descripcion
            };
        }
    }
}







.------



namespace reposicion_pin.DTOs
{
    public class ResultadoValidacionTarjetaDto
    {
        public string EquivalenteTC { get; set; } = string.Empty;
        public string FechaVencimientoTC { get; set; } = string.Empty;
        public string PinTC { get; set; } = string.Empty;
        public string CodigoError { get; set; } = "0"; // 0 = éxito
        public string DescripcionError { get; set; } = "Validación correcta";
    }
}






_____


using reposicion_pin.DTOs;
using reposicion_pin.Repository.Interface;

namespace reposicion_pin.Repository
{
    public class AS400Repository : IAS400Repository
    {
        // Simula la llamada al programa AS400 REIMQ07RC
        public async Task<ResultadoValidacionTarjetaDto> ValidarTarjetaAsync(string trama)
        {
            if (string.IsNullOrWhiteSpace(trama) || trama.Length != 81)
                throw new ArgumentException("La trama debe tener exactamente 81 caracteres.");

            // Simula tiempo de respuesta del AS400
            await Task.Delay(100);

            // Extraemos campos según posiciones
            string equivalenteTC = trama.Substring(0, 16).Trim();
            string fechaVencimiento = trama.Substring(16, 8).Trim();
            string pinTC = trama.Substring(24, 4).Trim();

            var resultado = new ResultadoValidacionTarjetaDto
            {
                EquivalenteTC = equivalenteTC,
                FechaVencimientoTC = fechaVencimiento,
                PinTC = pinTC
            };

            // Validaciones simuladas de errores según catálogo
            if (string.IsNullOrEmpty(equivalenteTC))
            {
                resultado.CodigoError = "P01";
                resultado.DescripcionError = "EQUIVALENTE TARJETA EN BLANCO";
            }
            else if (string.IsNullOrEmpty(fechaVencimiento))
            {
                resultado.CodigoError = "P02";
                resultado.DescripcionError = "FECHA VENCIMIENTO TARJETA EN BLANCO";
            }
            else if (equivalenteTC == "NOEXISTE1234567")
            {
                resultado.CodigoError = "P03";
                resultado.DescripcionError = "TARJETA NO EXISTE";
            }
            // P98 y P99 podrían agregarse en caso de error de sistema

            return resultado;
        }
    }
}





------




using reposicion_pin.DTOs;
using reposicion_pin.Repository.Interface;
using reposicion_pin.Service.Interface;

namespace reposicion_pin.Service
{
    public class TarjetaService : ITarjetaService
    {
        private readonly IAS400Repository _as400Repository;

        public TarjetaService(IAS400Repository as400Repository)
        {
            _as400Repository = as400Repository;
        }

        // Devuelve el resultado genérico para toda la app
        public async Task<ResultadoValidacionDto> ValidarTarjetaAsync(string trama)
        {
            var resultadoAS400 = await _as400Repository.ValidarTarjetaAsync(trama);

            // Mapeamos al DTO genérico
            var resultado = new ResultadoValidacionDto
            {
                EsValido = resultadoAS400.CodigoError == "0",
                Codigo = resultadoAS400.CodigoError,
                Descripcion = resultadoAS400.DescripcionError
            };

            return resultado;
        }
    }
}
